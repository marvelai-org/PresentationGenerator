# Image Generator Module

The Image Generator module creates visual elements for each slide based on its content. It analyzes the slide's title and content to produce relevant, high-quality images that enhance the presentation.

## How It Works

1. The module receives slide data containing titles and content
2. For each slide, it extracts key concepts and themes
3. A prompt is constructed for the image generation API
4. The generated image is stored in Supabase storage
5. The image URL is associated with the slide
6. The updated slide data with image URLs is returned

## Configuration

The Image Generator can be configured through environment variables:

- **Image Generation API Keys**:
  - `GOOGLE_API_KEY`: For Google's Vertex AI Imagen
  - `OPENAI_API_KEY`: For OpenAI's DALL-E
  - `TOGETHER_API_KEY`: For Together.ai's Diffusion models

- **Supabase Storage**:
  - `SUPABASE_URL`: URL of your Supabase project
  - `SUPABASE_SERVICE_KEY`: Service key for Supabase
  - `SUPABASE_STORAGE_BUCKET`: Bucket name (default: "slide-images")

- **Image Settings**:
  - `IMAGE_SIZE`: Default image size (default: "1024x1024")
  - `IMAGE_QUALITY`: Image quality setting (default: "standard")

## Usage

### Via API

```bash
curl -X POST http://localhost:8000/generate/images \
  -H "Content-Type: application/json" \
  -d '{
    "slides": [
      {
        "title": "What is Artificial Intelligence?",
        "content": "Artificial Intelligence (AI) refers to systems or machines that mimic human intelligence to perform tasks and can iteratively improve themselves based on the information they collect."
      }
    ]
  }'
```

### Via Python Code

```python
from ai_services.modules.image_generator.core import executor

result = executor(
    slides=[
        {
            "title": "What is Artificial Intelligence?",
            "content": "Artificial Intelligence (AI) refers to systems or machines that mimic human intelligence to perform tasks."
        }
    ],
    verbose=True
)

print(result["slides"])
```

## Parameters

| Parameter | Type | Description | Default |
|-----------|------|-------------|---------|
| slides | list[dict] | List of slide objects with title and content | (required) |
| verbose | bool | Whether to output detailed logs | False |

Each slide in the `slides` list should have at least:
- `title`: The title of the slide
- `content`: The content of the slide

## Response Format

The module returns a dictionary with "status" and "slides" keys:

```python
{
    "status": "success",
    "slides": [
        {
            "title": "What is Artificial Intelligence?",
            "content": "Artificial Intelligence (AI) refers to systems or machines that mimic human intelligence to perform tasks.",
            "image_url": "https://your-supabase-url.supabase.co/storage/v1/object/public/slide-images/ai_concept_1234.png"
        }
    ]
}
```

## Architecture

The Image Generator module consists of:

- `core.py`: Main functionality and entry point (`executor()` function)
- `tools.py`: Contains the `SlideImageGenerator` class with image generation logic
- `utils.py`: Utilities for image processing and storage

## Image Providers

The module supports multiple image generation providers:

1. **Google Vertex AI**: High-quality image generation with Imagen
   - Requires Google Cloud credentials
   - Good for professional-looking images

2. **OpenAI DALL-E**: Versatile image generation
   - Requires OpenAI API key
   - Good balance of quality and speed

3. **Together.ai**: Alternative image generation
   - Requires Together.ai API key
   - Various model options available

The module automatically selects the best available provider based on configured API keys.

## Storage Integration

Generated images are stored in Supabase Storage:

1. Images are generated as base64 data
2. The data is converted to PNG format
3. A unique filename is created for each image
4. The file is uploaded to the Supabase storage bucket
5. A public URL is generated for the image
6. This URL is returned in the response

## Customization

### Prompt Engineering

You can customize how prompts are generated by modifying the `_generate_prompt` method in the SlideImageGenerator class. For example:

```python
def _generate_prompt(self, slide):
    """Generate a prompt for image creation based on slide content."""
    title = slide.get("title", "")
    content = slide.get("content", "")
    
    # Extract key concepts
    key_concepts = self._extract_concepts(content)
    
    # Customize prompt based on slide type
    if "overview" in title.lower():
        return f"A conceptual overview visualization of {title}. {key_concepts}"
    elif "data" in title.lower() or "statistics" in title.lower():
        return f"A data visualization chart representing {title}. {key_concepts}"
    else:
        return f"A professional presentation slide visualization for the topic: {title}. {key_concepts}"
```

### Image Post-Processing

You can implement custom image post-processing by extending the SlideImageGenerator class:

```python
# Add a new method for image enhancement
def _enhance_image(self, image_data):
    """Apply enhancements to the generated image."""
    from PIL import Image, ImageEnhance
    import io
    import base64
    
    # Convert base64 to PIL Image
    image = Image.open(io.BytesIO(base64.b64decode(image_data)))
    
    # Apply enhancements
    enhancer = ImageEnhance.Contrast(image)
    image = enhancer.enhance(1.2)  # Increase contrast by 20%
    
    # Convert back to base64
    buffer = io.BytesIO()
    image.save(buffer, format="PNG")
    return base64.b64encode(buffer.getvalue()).decode("utf-8")
```

## Troubleshooting

Common issues and solutions:

1. **Storage Integration Issues**:
   - Error: `Storage error: Bucket not found`
   - Solution: Follow the [Supabase Storage Setup](../../supabase/storage-setup.md) guide

2. **Image Generation Failures**:
   - Error: `Failed to generate image: Invalid prompt`
   - Solution: Review slide content for inappropriate content or modify the prompt generation logic
   
3. **Slow Performance**:
   - Issue: Image generation taking too long
   - Solution: 
     - Process images in smaller batches
     - Consider caching common images
     - Use a faster API provider

4. **API Quota Exceeded**:
   - Error: `API quota exceeded` or `Rate limit exceeded`
   - Solution: 
     - Implement rate limiting and retry logic
     - Switch to a different provider temporarily
     - Increase your API quotas with the provider 